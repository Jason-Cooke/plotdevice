<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>

  <title>PlotDevice Libraries: Web</title>
  <link charset="utf-8" href="../etc/manual.css" rel="stylesheet" type="text/css"/>

</head><body>
  <div class="link" id="nav">
    <h1><a href="../manual.html">Plot Device <span>Libraries</span></a></h1>

    <h3>Web</h3>
  </div>

  <div class="article">
    <h2>Description</h2>

    <p>The PlotDevice Web library offers a collection of services to retrieve content from the
    internet. You can use the library to query <a href="http://www.yahoo.com">Yahoo!</a> for links,
    images, news and spelling suggestions, to read RSS and Atom newsfeeds, to retrieve articles
    from <a href="http://en.wikipedia.org">Wikipedia</a>, to collect quality images from <a href="http://www.morguefile.com">morgueFile</a> or <a href="http://www.flickr.com">Flickr</a>, to
    get color themes from <a href="http://kuler.adobe.com">kuler</a> or <a href="http://www.colr.org">Colr</a>, to browse through HTML documents, to clean up HTML, to validate
    URL’s, to create GIF images from math equations using <a href="http://www.forkosh.com/mimetex.html">mimeTeX</a>, to get ironic word definitions from <a href="http://www.urbandictionary.com">Urban Dictionary</a>.<br/></p>
    <p>The PlotDevice Web library works with a caching mechanism that stores things you download
    from the web, so they can be retrieved faster the next time. Many of the services also work
    asynchronously. This means you can use the library in an animation that keeps on running while
    new content is downloaded in the background.</p>
    <p>The library bundles Leonard Richardson’s <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a> to parse HTM, Mark Pilgrim’s
    <a href="http://www.feedparser.org/">Universal Feed Parser</a> for newsfeeds, a connection to
    John Forkosh’s mathTeX server (thanks Cedric Foellmi), Leif K-Brooks entity replace algorithm,
    <a href="http://code.google.com/p/simplejson/">simplejson</a>, and patches for Debian from the
    people at <a href="http://indywiki.sourceforge.net/">Indywiki</a>.<br/></p>
    <h2>Download</h2>

    <table border="0">
      <tbody>
        <tr>
          <td><a href="http://nodebox.net/code/data/media/web.zip"><img alt="download" height="20" src="../etc/lib/download.gif" width="20"/></a>
          </td><td><a href="http://nodebox.net/code/data/media/web-1.9.4.6.zip">web.zip</a> (390KB)<br/>
          <i>Last updated for PlotDevice 1.9.4.6<br/>
          Licensed under GPL<br/></i><i>Author: Tom De Smedt</i><br/>
        </td></tr></tbody></table>

    <h2>Documentation</h2>

    <ul>
      <li><a href="#library">How to get the library up and running</a></li>
      <li><a href="#validation">Validating web content</a><br/></li>
      <li><a href="#url">Working with URL’s</a></li>
      <li><a href="#html">Working with HTML</a></li>
      <li><a href="#yahoo">Querying Yahoo! for links, images and news</a></li>
      <li><a href="#yahoocontextual">Improving Yahoo! results with a contextual search</a></li>
      <li><a href="#yahoospelling">Using Yahoo! to suggest spelling corrections</a><br/></li>
      <li><a href="#yahoosort">Using Yahoo! to sort associatively</a></li>
      <li><a href="#google">Querying Google</a><br/></li>
      <li><a href="#newsfeed">Reading newsfeeds</a></li>
      <li><a href="#wikipedia">Retrieving articles from Wikipedia</a></li>
      <li><a href="#wikipediahelpers">Some helper commands to draw Wikipedia content in
      PlotDevice</a></li>
      <li><a href="#morguefile">Querying morgueFile for images</a></li>
      <li><a href="#flickr">Querying Flickr for images</a><br/></li>
      <li><a href="#kuler">Querying kuler for color themes</a></li>
      <li><a href="#colr">Querying Colr for color schemes</a></li>
      <li><a href="#math">Creating GIF images from math equations</a></li>
      <li><a href="#urbandictionary">Word definitions from Urban Dictionary</a><br/></li>
      <li><a href="#asynchronous">Working with asynchronous downloads</a></li>
      <li><a href="#cache">Clearing the cache</a></li>
      <li><a href="#json">Reading JSON</a><br/></li>
    </ul>

    <p> </p>
    <hr/>

    <h2><a id="library" name="library" title="library"></a>How to get the library up and
    running</h2>

    <p>Put the <i>web</i> library folder in the same folder as your script so PlotDevice can find
    the library.<br/>
    You can also put it in <i>~/Library/Application Support/PlotDevice/.</i></p>
<pre>web <span class="o">=</span> <span class="nf">ximport</span>(<span class="s">"web"</span>)
</pre>

    <p><span class="small_text">Outside of PlotDevice you can also just do <i>import
    web</i>.</span></p>
    <p><span class="grey_box">Proxy servers</span> <br/></p>
    <p>If you are behind a proxy server the library may not be able to connect to the internet.<br/>
    In that case you need to inform the library with the <i>set_proxy()</i> command:</p>
<pre>web<span class="o">.</span>set_proxy(<span class="s">"https://www.myproxyserver.com:80"</span>, <span class="nb">type</span><span class="o">=</span><span class="s">"https"</span>)
</pre>                                          
    <hr/>

    <h2><a id="validation" name="validation" title="validation"></a>Validating web content</h2>

    <p>Web content is accessed with a URL, the address you use to connect to a place on the
    internet. The library has a number of commands to find out what type of content (e.g. web page,
    image, ...) is associated with a given URL.</p>
    <p>The most basic command, <i>is_url()</i> checks whether a given string is a grammatically
    correct URL (e.g. <i>http://nodebox.net</i> but not <i>htp://nodebox.net</i>). It takes a wait
    parameter indicating the number of seconds after which the library should stop connecting to
    the internet and give up.</p>
<pre>web<span class="o">.</span>is_url(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>

    <p>Even if a URL is valid, it might not refer to actual content on the internet. We can check
    if a URL exists with the <i>not_found()</i> command:</p>
<pre>web<span class="o">.</span>url<span class="o">.</span>not_found(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>

    <p>The following commands are useful to find out what content is associated with the URL. We
    can discern between HTML web pages which we can parse with <i><a href="#html">page.parse()</a></i>, newsfeeds which we can parse with <i><a href="#newsfeed">newsfeed.parse()</a></i>, images, audio and video etc. which we can download with
    <i><a href="#url">url.retrieve()</a></i>.</p>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_webpage(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_stylesheet(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_plaintext(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_pdf(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_newsfeed(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_image(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_audio(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_video(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>is_archive(url, wait<span class="o">=</span><span class="mi">10</span>)
</pre>                                                        
    <hr/>

    <h2><a id="url" name="url" title="url"></a>Working with URL’s</h2>

    <p>A <a href="http://en.wikipedia.org/wiki/Url">URL</a> is  the address you use to connect
    to a page on the internet, for example: <i>http://nodebox.net</i>. The PlotDevice Web library
    can do three different things with a URL: download the content associated with it, parse it
    (find out which parts make up the URL) and construct it from scratch (a simple way to create a
    URL with HTTP GET or HTTP POST data).</p>
<pre>web<span class="o">.</span>download(url, wait<span class="o">=</span><span class="mi">60</span>, cache<span class="o">=</span><span class="bp">None</span>, <span class="nb">type</span><span class="o">=</span><span class="s">".html"</span>)
</pre>
<pre>web<span class="o">.</span><span class="nf">save</span>(url, path<span class="o">=</span><span class="s">""</span>, wait<span class="o">=</span><span class="mi">60</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>retrieve(url, wait<span class="o">=</span><span class="mi">60</span>, asynchronous<span class="o">=</span><span class="bp">False</span>, cache<span class="o">=</span><span class="bp">None</span>, <span class="nb">type</span><span class="o">=</span><span class="s">".html"</span>)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>parse(url)
</pre>
<pre>web<span class="o">.</span>url<span class="o">.</span>create(url<span class="o">=</span><span class="s">""</span>, method<span class="o">=</span><span class="s">"get"</span>)
</pre>

    <p>The <i>download()</i> command returns the content associated with the given web address. The
    command has an optional parameter <i>wait</i> that determines <b>how long to wait for a
    download</b>. If the time is exceeded, the download is aborted.</p>
    <p>The last two parameters can be used to <b>cache downloaded content locally</b>, so it
    doesn’t have to downloaded again in the future. The <i>cache</i> parameter is a string with the
    name of a subfolder in /cache where to store content. The <i>type</i> parameter is the file
    extension of the downloaded content.</p>
    <p>The <i>save()</i> command stores the URL’s content at the given local path. If no path is
    given it will attempt to extract a filename from the URL and store that in the current working
    directory. The path to the saved file is returned.</p>
    <p>The Web library also has easier ways to deal with specific web content like HTML
    (<i>page.parse()</i> command) or Wikipedia articles (<i>wikipedia.search()</i> command) for
    example.</p>
    <p>The <i>download()</i> command is actually an alias of the <i>url.retrieve()</i> command.
    This command has an additional <i>asynchronous</i> parameter useful to <b>download stuff in the
    background</b> while an animation keeps on running. We’ll see about asynchronous downloads
    later on. The <i>url.retrieve()</i> command returns an object with a <i>data</i> property
    containing a string with the downloaded content. If you don’t need anything that complicated
    just use the easy <i>download()</i> command:<br/></p>
<pre>
<span class="c"># Download an image from the PlotDevice Gallery.</span>
url <span class="o">=</span> <span class="s">"http://nodebox.net/code/data/media/twisted-final.jpg"</span>
img <span class="o">=</span> web<span class="o">.</span>download(url)
 
<span class="c"># Display the image data in PlotDevice.</span>
<span class="nf">image</span>(<span class="bp">None</span>, <span class="mi">0</span>, <span class="mi">0</span>, data<span class="o">=</span>img)
 
<span class="c"># Write the image data to a file.</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span>(<span class="s">"twisted.jpg"</span>, <span class="s">"w"</span>)
<span class="nb">file</span><span class="o">.</span>write(img)
<span class="nb">file</span><span class="o">.</span>close()
</pre>        

    <p><img alt="web_url1" height="390" src="../etc/lib/web_url1.jpg" width="550"/><br/></p>
    <p> </p>
    <p>The <i>url.parse()</i> command splits a given url into its components. The returned objects
    has the following properties:</p>
    <ul>
      <li><i>url.protocol</i>: the type of internet service, usually <i>http</i></li>
      <li><i>url.domain</i>: the domain name, for example, <i>nodebox.net</i><br/></li>
      <li><i>url.username</i>: a username for a secure connection<br/></li>
      <li><i>url.password</i>: a password for a secure connection</li>
      <li><i>url.port</i>: the port number at the host</li>
      <li><i>url.path</i>: the subdirectory at the server, for example <i>/code/index.php/</i></li>
      <li><i>url.page</i>: the name of the document, for example <i>search</i><br/></li>
      <li><i>url.anchor</i>: named anchor on the page<br/></li>
      <li><i>url.query</i>: a dictionary of query string values, for example <i>{ ‘q’: ‘pixels’
      }</i><br/></li>
      <li><i>url.method</i>: the query string method either ‘get’ or ‘post’<br/></li>
    </ul>

    <p>In the same way the <i>url.create()</i> command returns an object with these properties.
    This command is useful to, for example, construct URL’s with a POST query and pass that to
    <i>url.retrieve()</i> or <i>page.parse()</i>.</p>
    <p>For example. this script retrieves the first 10 forum pages from PlotDevice:</p>
<pre>url <span class="o">=</span> web<span class="o">.</span>url<span class="o">.</span>create(<span class="s">"http://nodebox.net/code/index.php/Share"</span>)
url<span class="o">.</span>query[<span class="s">"p"</span>] <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span>(<span class="mi">10</span>):
    <span class="k">print</span> web<span class="o">.</span>url<span class="o">.</span>retrieve(url)<span class="o">.</span>data
    url<span class="o">.</span>query[<span class="s">"p"</span>] <span class="o">+=</span> <span class="mi">1</span>
</pre>                                                                         
    <hr/>

    <h2><a id="html" name="html" title="html"></a>Working with HTML</h2>

    <p>The PlotDevice Web library uses Leonard Richardson’s <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a> to parse HTML content. This
    means you can search and loop through all the tags in the HTML. For example, you might want to
    download a HTML page from the internet, find all the links in it and then download all those
    links. Or find all the image tags in the source and then retrieve all those images with
    <i>download()</i>.</p>
    <p>The <i>page.parse()</i> command takes a URL as input and returns a Beautiful Soup object.
    The optional <i>cached</i> parameter determines if downloaded pages should be cached locally
    for faster retrieval.</p>
<pre>web<span class="o">.</span>page<span class="o">.</span>parse(url, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>You can get the meta information in the HTML header with the returned object’s <i>title</i>,
    <i>description</i> and <i>keywords</i> properties:</p>
<pre>html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://nodebox.net"</span>)
 
<span class="k">print</span> html<span class="o">.</span>description
<span class="o">&gt;&gt;&gt;</span> PlotDevice <span class="ow">is</span> a Mac OS X application that lets you create <span class="mi">2</span>D visuals 
<span class="o">&gt;&gt;&gt;</span> (static, animated <span class="ow">or</span> interactive) using Python programming code 
<span class="o">&gt;&gt;&gt;</span> <span class="ow">and</span> <span class="nf">export</span> them <span class="k">as</span> a PDF <span class="ow">or</span> a QuickTime movie<span class="o">.</span> PlotDevice <span class="ow">is</span> free 
<span class="o">&gt;&gt;&gt;</span> <span class="ow">and</span> well<span class="o">-</span>documented<span class="o">.</span>
 
<span class="k">print</span> html<span class="o">.</span>keywords
<span class="o">&gt;&gt;&gt;</span>[<span class="s">u'PlotDevice'</span>, <span class="s">u'Home'</span>]
</pre>

    <p>You can easily get all the links in the HTML with the <i>links()</i> method. It takes an
    optional <i>external</i> parameter which when True, returns only links to other
    domains/websites.</p>
<pre>html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://nodebox.net/code/index.php/About"</span>)
<span class="k">print</span> html<span class="o">.</span>links()
<span class="o">&gt;&gt;&gt;</span> [<span class="s">u'http://research.nodebox.net'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://www.opensource.org/licenses/mit-license.php'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://www.python.org/'</span>, <span class="s">u'http://bert.debruijn.be/kgp/'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://diveintopython.org/xml_processing/'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://processing.org'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://www.freelists.org/archives/the_posthumans/'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'http://research.nodebox.net'</span>
<span class="o">&gt;&gt;&gt;</span> ]
</pre>

    <p>The <i>find_all()</i> method returns a list of specific tags. The <i>find()</i> method just
    returns the first tag:</p>
<pre>html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://nodebox.net/"</span>)
 
<span class="k">print</span> html<span class="o">.</span>find(<span class="s">"title"</span>)<span class="o">.</span>string
<span class="o">&gt;&gt;&gt;</span> PlotDevice <span class="o">|</span> Home
 
titles <span class="o">=</span> html<span class="o">.</span>find_all(<span class="s">"h2"</span>)
<span class="k">for</span> title <span class="ow">in</span> titles:
    <span class="k">print</span> title<span class="o">.</span>string
<span class="o">&gt;&gt;&gt;</span> News
<span class="o">&gt;&gt;&gt;</span> Current projects 
<span class="o">&gt;&gt;&gt;</span> Gallery favorites
 
content <span class="o">=</span> html<span class="o">.</span>find(<span class="nb">id</span><span class="o">=</span><span class="s">"content"</span>)
<span class="k">print</span> web<span class="o">.</span>html<span class="o">.</span>plain(content)
<span class="o">&gt;&gt;&gt;</span> Welcome to PlotDevice PlotDevice <span class="ow">is</span> a Mac OS X application 
<span class="o">&gt;&gt;&gt;</span> that lets you create <span class="mi">2</span>D visuals (static, animated <span class="ow">or</span> interactive) 
<span class="o">&gt;&gt;&gt;</span> using Python programming code <span class="ow">and</span> <span class="nf">export</span> them <span class="k">as</span> a PDF <span class="ow">or</span> 
<span class="o">&gt;&gt;&gt;</span> a QuickTime movie<span class="o">.</span> PlotDevice <span class="ow">is</span> free <span class="ow">and</span> well<span class="o">-</span>documented<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> Read more 
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> Download PlotDevice <span class="k">for</span> Mac OS X (version <span class="mf">1.8</span><span class="o">.</span><span class="mi">5</span>) Universal Binary
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> Latest updates:
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Interactivity
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Stop running scripts by hitting command<span class="o">-</span>dot<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">...</span>
</pre>

    <p>As you can see you can supply tag names or attribute-value pairs to the find methods.</p>
    <p>The <i>find()</i> and <i>find_all()</i> methods return <i>Tag</i> objects that each have
    <i>find()</i> and <i>find_all()</i> too. Alternatively, you can also find tags more directly,
    for example: <i>html.body.p</i> returns a list of all p tags.</p>
<pre>html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://nodebox.net/"</span>)
 
<span class="nb">list</span> <span class="o">=</span> html<span class="o">.</span>find(<span class="nb">id</span><span class="o">=</span><span class="s">"content"</span>)<span class="o">.</span>find(<span class="s">"ul"</span>)
<span class="k">print</span> web<span class="o">.</span>html<span class="o">.</span>plain(<span class="nb">list</span>)
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Interactivity
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Stop running scripts by hitting command<span class="o">-</span>dot<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Transparent PDFs <span class="k">with</span> the <span class="nf">background</span>() command<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Fast, integrated path mathematics <span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">*</span> Store libaries centrally <span class="ow">in</span> the Application Support folder<span class="o">.</span>
 
<span class="c"># These statements retrieve exactly the same.</span>
<span class="nb">list</span> <span class="o">=</span> html<span class="o">.</span>body(<span class="nb">id</span><span class="o">=</span><span class="s">"content"</span>)[<span class="mi">0</span>]<span class="o">.</span>ul
<span class="nb">list</span> <span class="o">=</span> html<span class="o">.</span>body<span class="o">.</span>ul
</pre>

    <p>If you need to retrieve tags by their CSS classname, use the <i>find_class()</i> method.<br/></p>
    <p>To get attributes from a tag, address it as a dictionary:</p>
<pre>html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://nodebox.net/"</span>)
html<span class="o">.</span>body<span class="o">.</span>a[<span class="s">"href"</span>] <span class="c"># the first link's href attribute</span>
<span class="o">&gt;&gt;&gt;</span> Home
</pre>                                                                 
    <hr/>

    <p>The PlotDevice Web library has various commands to clean up HTML.</p>
<pre>
<span class="c"># Replaces HTML special characters by readable characters.</span>
web<span class="o">.</span>html<span class="o">.</span>replace_entities(<span class="nb">unicode</span>, placeholder<span class="o">=</span><span class="s">" "</span>)
</pre>
<pre>
<span class="c"># Removes all tags from HTML except those in the exclude list.</span>
web<span class="o">.</span>html<span class="o">.</span>strip_tags(html, exclude<span class="o">=</span>[], linebreaks<span class="o">=</span><span class="bp">False</span>, 
                    blocks<span class="o">=</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>, breaks<span class="o">=</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>, columns<span class="o">=</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>)
</pre>
<pre>web<span class="o">.</span>html<span class="o">.</span>strip_javascript(html)
</pre>
<pre>web<span class="o">.</span>html<span class="o">.</span>strip_inline_css(html)
</pre>
<pre>web<span class="o">.</span>html<span class="o">.</span>strip_comments(html)
</pre>
<pre>web<span class="o">.</span>html<span class="o">.</span>strip_forms(html)
</pre>
<pre>
<span class="c"># If there are 10 consecutive spaces, 9 of them are removed.</span>
web<span class="o">.</span>html<span class="o">.</span>collapse_spaces(<span class="nb">str</span>)
</pre>
<pre>
<span class="c"># Allow only a maximum of max linebreaks to build up.</span>
web<span class="o">.</span>html<span class="o">.</span>collapse_linebreaks(<span class="nb">str</span>, <span class="nb">max</span><span class="o">=</span><span class="mi">2</span>)
</pre>
<pre>
<span class="c"># Converts tabs to spaces, optionally leaving the left indentation unmodified.</span>
web<span class="o">.</span>html<span class="o">.</span>collapse_tabs(<span class="nb">str</span>, indent<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>
<span class="c"># Combines all of the above.</span>
web<span class="o">.</span>html<span class="o">.</span>plain(html)
</pre>                                                                                                                            
    <hr/>

    <h2><a id="yahoo" name="yahoo" title="yahoo"></a>Querying Yahoo! for links, images and
    news</h2>

    <p>Before you can use the Web library to query the Yahoo! search engine, you need to obtain
    <b>a license key</b>: <a href="http://developer.yahoo.com/search/">http://developer.yahoo.com/search/</a></p>
    <p>Click  ‘get an application ID’. Fill out the form and you’ll end up with a long string
    of numbers and characters which is your Yahoo! license key. It entitles you to 5000 queries a
    day. Now register your license key in your PlotDevice script:<br/></p>
<pre>web<span class="o">.</span>yahoo<span class="o">.</span>license_key(<span class="s">"myID"</span>)
<span class="k">print</span> web<span class="o">.</span>yahoo<span class="o">.</span>license_key()
<span class="o">&gt;&gt;&gt;</span> myID
</pre>

    <p>Note that you can query Yahoo! without setting a license key, in which case you are using a
    default key that you share with all the other PlotDevice users who work with the Web library.</p>
    <p>Use the <i>yahoo.search()</i>, <i>yahoo.search_images()</i> and <i>yahoo.search_news()</i>
    commands to query Yahoo! for links to relevant webpages/images/news:</p>
<pre>web<span class="o">.</span>yahoo<span class="o">.</span>search(q, start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">10</span>, context<span class="o">=</span><span class="bp">None</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>yahoo<span class="o">.</span>search_images(q, start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>yahoo<span class="o">.</span>search_news(q, start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>

    <p>The commands take a <i>q</i> query parameter, and optional <i>start</i>, <i>count</i> and
    <i>cached</i> parameters. The <i>start</i> parameter defines the first link to return,
    <i>count</i> defines the total amount of links to return. The <i>cached</i> parameter defines
    if Yahoo queries are cached locally (so they can be retrieved faster in the future).</p>
<pre>results <span class="o">=</span> web<span class="o">.</span>yahoo<span class="o">.</span>search(<span class="s">"plotdevice"</span>, start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">5</span>, cached<span class="o">=</span><span class="bp">False</span>)
<span class="k">for</span> item <span class="ow">in</span> results:
    <span class="k">print</span> item<span class="o">.</span>title
<span class="o">&gt;&gt;&gt;</span> PlotDevice <span class="o">|</span> Home 
<span class="o">&gt;&gt;&gt;</span> PlotDevice <span class="o">|</span> Features 
<span class="o">&gt;&gt;&gt;</span> visualcomplexity<span class="o">.</span>com <span class="o">|</span> PlotDevice 
<span class="o">&gt;&gt;&gt;</span> PlotDevice <span class="o">-</span> Wikipedia, the free encyclopedia 
<span class="o">&gt;&gt;&gt;</span> Nodebox <span class="o">-</span> SWiK
</pre>

    <p>Each item in the list of results is a <i>YahooResult</i> object with the following
    properties:</p>
    <ul>
      <li><i>result.url</i>: the URL of the linked page</li>
      <li><i>result.title</i>: the title of the linked page</li>
      <li><i>result.description</i>: a short description for the page</li>
      <li><i>result.type</i>: the <a href="http://en.wikipedia.org/wiki/Mimetype">MIME-type</a> of
      the linked page</li>
      <li><i>result.date</i>: the modification date of the linked page</li>
      <li><i>result.width</i>: for images, the width in pixels</li>
      <li><i>result.height</i>: for images, the height in pixels</li>
      <li><i>result.source</i>: for news items, the source of the article</li>
      <li><i>result.language</i>: for news items, the language used<br/></li>
    </ul>

    <p>The list of results has a <i>total</i> property containing the total number of results
    Yahoo! has for your query:</p>
<pre>
<span class="k">print</span> results<span class="o">.</span>total
<span class="o">&gt;&gt;&gt;</span> <span class="mi">37200</span>
</pre>                                                                                                                      
    <hr/>

    <h2><a id="yahoocontextual" name="yahoocontextual" title="yahoocontextual"></a>Improving Yahoo!
    results with a contextual search</h2>

    <p>Suppose you are querying Yahoo! for <i>apple</i>. Most likely Yahoo! will return links to
    pages relating to the Apple Computer company. But perhaps you wanted links to apples as in
    <i>fruit</i>. The <i>yahoo.search()</i> command has an optional <i>context</i> parameter which
    you can supply a description of what you mean exactly with <i>apple</i>:</p>
<pre>ctx <span class="o">=</span> <span class="s">'''</span>
<span class="s">The apple tree was perhaps the earliest tree to be cultivated, </span>
<span class="s">and apples have remained an important food in all cooler climates. </span>
<span class="s">To a greater degree than other tree fruit, except possibly citrus, </span>
<span class="s">apples store for months while still retaining their nutritive value.</span>
<span class="s">We are not looking for a company named Apple.</span>
<span class="s">'''</span>
results <span class="o">=</span> web<span class="o">.</span>yahoo<span class="o">.</span>search(<span class="s">"apple"</span>, count<span class="o">=</span><span class="mi">5</span>, context<span class="o">=</span>ctx)
<span class="k">print</span> r<span class="o">.</span>total
<span class="k">for</span> item <span class="ow">in</span> results:
    <span class="k">print</span> item<span class="o">.</span>title
<span class="o">&gt;&gt;&gt;</span> Apple <span class="o">-</span> Wikipedia, the free encyclopedia
<span class="o">&gt;&gt;&gt;</span> Apple Core
<span class="o">&gt;&gt;&gt;</span> Apple <span class="o">-</span> Free Encyclopedia
<span class="o">&gt;&gt;&gt;</span> Apple : Apple (fruit)
<span class="o">&gt;&gt;&gt;</span> About the Apple <span class="o">--</span> Fruit
</pre>

    <p> </p>
    <hr/>

    <h2><a id="yahoospelling" name="yahoospelling" title="yahoospelling"></a>Using Yahoo! to
    suggest spelling corrections</h2>

    <p>To get spelling suggestions from Yahoo, use the <i>yahoo.suggest_spelling()</i> command. It
    returns a list of suggested spelling corrections:</p>
<pre>corrections <span class="o">=</span> web<span class="o">.</span>yahoo<span class="o">.</span>suggest_spelling (<span class="s">"amazoon"</span>, cached<span class="o">=</span><span class="bp">False</span>)
<span class="k">print</span> corrections
<span class="o">&gt;&gt;&gt;</span> [<span class="s">'amazon'</span>]
</pre>     

    <p>               </p>
    <hr/>

    <h2><a id="yahoosort" name="yahoosort" title="yahoosort"></a>Using Yahoo! to sort
    associatively</h2>

    <p>You can use Yahoo! to sort concepts according to association. Is <i>sky</i> more
    <i>green</i>, <i>red</i> or <i>blue</i>?</p>
<pre>
<span class="nf">colors</span> <span class="o">=</span> [<span class="s">"green"</span>, <span class="s">"blue"</span>, <span class="s">"red"</span>]
<span class="nb">sorted</span> <span class="o">=</span> web<span class="o">.</span>yahoo<span class="o">.</span>sort(<span class="nf">colors</span>, <span class="s">"sky"</span>, strict<span class="o">=</span><span class="bp">False</span>, cached<span class="o">=</span><span class="bp">True</span>)
<span class="k">for</span> word, weight <span class="ow">in</span> <span class="nb">sorted</span>:
    <span class="k">print</span> word, weight
<span class="o">&gt;&gt;&gt;</span> blue sky <span class="mf">0.396039408425</span>
<span class="o">&gt;&gt;&gt;</span> red sky <span class="mf">0.33604773392</span>
<span class="o">&gt;&gt;&gt;</span> green sky <span class="mf">0.267912857655</span>
</pre>

    <p>In this example, Yahoo! is queried for <i>green sky</i>, <i>blue sky</i> and <i>red sky</i>.
    The result is a sorted list of (<i>query</i>, <i>weight</i>) tuples. We learn that <i>blue</i>
    is the color best associated with <i>sky</i>.</p>
    <p>The <a href="http://nodebox.net/code/index.php/Prism">Prism</a> algorithm roughly works in
    this way.</p>
    <p> </p>
    <hr size="2" width="100%"/>

    <h2><a id="google" name="google" title="google"></a>Querying Google</h2>

    <p>You can run <a href="http://www.google.com">Google</a> queries in the same way as <a href="#yahoo">querying Yahoo!</a>.<br/>
    The library has the following commands available:</p>
<pre>web<span class="o">.</span>google<span class="o">.</span>search(q, start<span class="o">=</span><span class="mi">0</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>google<span class="o">.</span>search_images(q, start<span class="o">=</span><span class="mi">0</span>, <span class="nf">size</span><span class="o">=</span><span class="s">""</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>google<span class="o">.</span>search_news(q, start<span class="o">=</span><span class="mi">0</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>google<span class="o">.</span>search_blogs(q, start<span class="o">=</span><span class="mi">0</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>
<pre>web<span class="o">.</span>google<span class="o">.</span>sort(words, context<span class="o">=</span><span class="s">""</span>, strict<span class="o">=</span><span class="bp">True</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>

    <p>The search commands return a list of results. This list has an additional <i>total</i>
    property. Each item in the list is a <i>GoogleResult</i> object with the following properties:</p>
    <ul>
      <li><i>result.url</i>: the URL of the linked page</li>
      <li><i>result.title</i>: the title of the linked page</li>
      <li><i>result.description</i>: a short description for the page</li>
      <li><i>result.date</i>: for news and blogs search</li>
      <li><i>result.author</i>: for news and blogs search.</li>
      <li><i>result.location</i>: for news search.</li>
    </ul>

    <p>Per search, a list of 8 items is returned from the given <i>start</i> item. Google will only
    ever return the first 32 results, so the maximum value for <i>start</i> is 24.</p>
    <p>When searching for images, the results can be filtered for image <i>size</i> with the
    optional size parameter.<br/>
    Acceptable values are ‘small’, ‘medium’, ‘large’ and ‘wallpaper’.<br/></p>
    <p> </p>
    <hr/>

    <h2><a id="newsfeed" name="newsfeed" title="newsfeed"></a>Reading newsfeeds</h2>

    <p>The <i>newsfeed.read()</i> command returns information from <a href="http://en.wikipedia.org/wiki/Rss">RSS</a> or <a href="http://en.wikipedia.org/wiki/Atom_%28standard%29">Atom</a> newsfeeds as a collection of news
    items with a title, link, description, and more.</p>
<pre>web<span class="o">.</span>newsfeed<span class="o">.</span>parse(url, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>The returned newsfeed object has the following properties:</p>
    <ul>
      <li><i>newsfeed.title</i>: the title of the newsfeed<br/></li>
      <li><i>newsfeed.description</i>: a short description for the newsfeed<br/></li>
      <li><i>newsfeed.link</i>: a link to the homepage of the news channel<br/></li>
      <li><i>newsfeed.date</i>: a publication date of the news channel<br/></li>
      <li><i>newsfeed.encoding</i>: the text encoding used (usually Unicode)<br/></li>
      <li><i>newsfeed.items</i>: a list of news items<br/></li>
    </ul>

    <p>The <i>items</i> property is a list in which each item object has properties of its own:</p>
    <ul>
      <li><i>item.title</i>: the title of the news item<br/></li>
      <li><i>item.link</i>: a link to the full article online</li>
      <li><i>item.description</i>: a short description of the news item</li>
      <li><i>item.date</i>: the publication date of the news item<br/></li>
      <li><i>item.author</i>: the author of the news item</li>
    </ul><br/>
<pre>newsfeed <span class="o">=</span> web<span class="o">.</span>newsfeed<span class="o">.</span>parse<span class="s">"http://www.whitehouse.gov/rss/news.xml"</span>)
 
<span class="k">print</span> <span class="s">"Channel:"</span>, newsfeed<span class="o">.</span>title
<span class="k">print</span> <span class="s">"Channel description:"</span>, newsfeed<span class="o">.</span>description
 
<span class="k">for</span> item <span class="ow">in</span> newsfeed<span class="o">.</span>items:
    <span class="k">print</span> <span class="s">"Title:"</span>, item<span class="o">.</span>title
    <span class="k">print</span> <span class="s">"Link:"</span>, item<span class="o">.</span>link
    <span class="k">print</span> <span class="s">"Description"</span>, item<span class="o">.</span>description    
    <span class="k">print</span> <span class="s">"Date:"</span>, item<span class="o">.</span>date
    <span class="k">print</span> <span class="s">"Author:"</span>, item<span class="o">.</span>author
</pre>

    <p><br/>
    There are other properties as well, like <i>item.date_parsed</i>, <i>item.author_detail</i> and
    <i>item.author_detail.email</i>. See the <a href="http://www.feedparser.org/">Universal Feed
    Parser</a> documentation for more information.</p>
    <p>The address of some well-known newsfeeds can be found in the <i>newsfeed.favorites</i>
    dictionary or with the <i>newsfeed.favorite_url()</i> command:</p>
<pre>
<span class="k">print</span> web<span class="o">.</span>newsfeed<span class="o">.</span>favorite_url(<span class="s">"apple"</span>)
<span class="o">&gt;&gt;&gt;</span> http:<span class="o">//</span>images<span class="o">.</span>apple<span class="o">.</span>com<span class="o">/</span>main<span class="o">/</span>rss<span class="o">/</span>hotnews<span class="o">/</span>hotnews<span class="o">.</span>rss
</pre>                                          
    <hr/>

    <h2><a id="wikipedia" name="wikipedia" title="wikipedia"></a>Retrieving articles from
    Wikipedia</h2>

    <p><a href="http://en.wikipedia.org/">Wikipedia</a> is a multilingual, web-based, free content
    encyclopedia project. Wikipedia is written collaboratively by volunteers; the vast majority of
    its articles can be edited by anyone with access to the Internet.</p>
    <p>The <i>wikipedia.search()</i> command retrieves articles from Wikipedia. It parses an
    article corresponding to the given query into lists of related articles and paragraphs of plain
    text without any HTML or other markup in it:</p>
<pre>web<span class="o">.</span>wikipedia<span class="o">.</span>search(q, language<span class="o">=</span><span class="s">"en"</span>, light<span class="o">=</span><span class="bp">False</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>The command takes a <i>q</i> query parameter and, optionally, the <i>language</i> the
    article should be written in. When <i>light</i> is True, only a <i>title</i>, <i>links</i> to
    other articles, <i>categories</i> and <i>disambiguation</i> will be parsed from the article
    (it’s faster than a full parse).</p>
    <p>Note that the <i>q</i> parameter is case-insenstive - this gives the best chance of
    retrieving an article.<br/>
    If you do want case-sensitivity use <i>search(q, case_sensitive=True)</i>.</p>
    <p>The return value is an article object with the following properties:</p>
    <ul>
      <li><i>article.title</i>: the title of the article<br/></li>
      <li><i>article</i><i>.links</i>: a list of titles of related articles</li>
      <li><i>article</i><i>.categories</i>: a list of categories this article belongs to<br/></li>
      <li><i>article</i><i>.disambiguation</i>: a list of article titles describing other
      interpretations of the query</li>
      <li><i>article</i><i>.paragraphs</i>: a list of paragraph objects
      (<i>WikipediaParagraph</i>)<br/></li>
      <li><i>article</i> <i>.images</i>: a list of image objects (<i>WikipediaImage</i>)</li>
      <li><i>article</i><i>.tables</i>: a list of table objects (<i>WikipediaTable</i>)</li>
      <li><i>article</i><i>.references</i>: a list of reference objects (<i>WikipediaReference</i>)</li>
      <li><i>article</i><i>.translations</i>: a dictionary of language keys linking to title
      translations<br/></li>
      <li><i>article</i><i>.important</i>: important phrases that appear in bold in the online
      article<br/></li>
      <li><i>article</i><i>.markup</i>: the source text of the article in <a href="http://www.mediawiki.org/wiki/MediaWiki">MediaWiki</a> markup</li>
    </ul>

    <p> </p>
    <hr/>

    <p><span class="grey_box">Article links</span></p>
    <p>Each of the titles in the <i>article.links</i> list can be supplied to
    <i>wikipedia.search()</i> to get more information on that topic.</p>
<pre>article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"plotdevice"</span>)
<span class="k">print</span> article<span class="o">.</span>title
<span class="k">print</span> article<span class="o">.</span>links
<span class="o">&gt;&gt;&gt;</span> PlotDevice
<span class="o">&gt;&gt;&gt;</span> [<span class="s">u'2007'</span>, <span class="s">u'2D computer graphics'</span>, <span class="s">u'Adobe Photoshop'</span>, <span class="s">u'Animation'</span>,
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'CMYK'</span>, <span class="s">u'Computer animation'</span>, <span class="s">u'Core Image'</span>, <span class="s">u'DrawBot'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'February 27'</span>, <span class="s">u'Graphic design'</span>, <span class="s">u'HSV color space'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'MIT License'</span>, <span class="s">u'Mac OS X'</span>, <span class="s">u'OpenGL'</span>, <span class="s">u'Portable Document Format'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'PostScript'</span>, <span class="s">u'Processing (programming language)'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'Python (programming language)'</span>, <span class="s">u'QuickTime'</span>, <span class="s">u'RGB'</span>, <span class="s">u'SVG'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'WordNet'</span>, <span class="s">u'alpha transparency'</span>, <span class="s">u'artificial intelligence'</span>, 
<span class="o">&gt;&gt;&gt;</span>  <span class="s">u'collage'</span>, <span class="s">u'graphic design'</span>
<span class="o">&gt;&gt;&gt;</span> ]
</pre>                                                                                                      
    <hr/>

    <p><span class="grey_box">Article paragraphs</span></p>
    <p>Each paragraph object in <i>article.paragraphs</i>  is a list of plain text blocks.
    Furthermore, a paragraph has a number of  properties. This code snippet loops through all
    the paragraphs:</p>
<pre>article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"plotdevice"</span>)
<span class="k">for</span> paragraph <span class="ow">in</span> article<span class="o">.</span>paragraphs:    
    <span class="c"># A paragraph's depth determines</span>
    <span class="c"># if it's a subparagraph or a top-level paragraph.</span>
    <span class="k">if</span> paragraph<span class="o">.</span>depth <span class="o">&lt;=</span> <span class="mi">1</span>:
        <span class="k">print</span> <span class="s">"="</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">else</span>:
        <span class="k">print</span> <span class="s">"-"</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">print</span> paragraph<span class="o">.</span>title <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="c"># Each paragraph is a list of separate blocks of text:</span>
    <span class="k">for</span> textblock <span class="ow">in</span> paragraph:
        <span class="k">print</span> textblock <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
</pre>

    <p>To display a paragraph with the <a href="../ref/Typography.html#text()">text()</a> command
    you can loop over all the textblocks individually:</p>
<pre>
<span class="nf">fontsize</span>(<span class="mi">10</span>)
x, y, w <span class="o">=</span> <span class="mi">20</span>, <span class="mi">20</span>, <span class="mi">300</span>
<span class="k">for</span> textblock <span class="ow">in</span> article<span class="o">.</span>paragraphs[<span class="mi">0</span>]:
    <span class="nf">text</span>(textblock, x, y, width<span class="o">=</span>w)
    y <span class="o">+=</span> <span class="nf">textheight</span>(textblock, width<span class="o">=</span>w) <span class="o">+</span> <span class="mi">10</span>
</pre>

    <p>Or simply use the Python <i>str()</i> command on the entire list:</p>
<pre>
<span class="nf">text</span>(<span class="nb">str</span>(article<span class="o">.</span>paragraphs[<span class="mi">0</span>]), <span class="mi">20</span>, <span class="mi">20</span>, width<span class="o">=</span><span class="mi">300</span>)
</pre>

    <p>A paragraph object has the following properties:</p>
    <ul>
      <li><i>paragraph.title</i>: the title or heading of this paragraph<br/></li>
      <li><i>paragraph.depth</i>: the depth of the paragraph<br/></li>
      <li><i>paragraph.parent</i>: a <i>WikipediaParagraph</i> object containing this subparagraph</li>
      <li><i>paragraph.children</i>: a list of sub-<i>WikipediaParagraph</i> objects</li>
      <li><i>paragraph.main</i>: a list of article titles whose contents describe this paragraph in
      detail</li>
      <li><i>paragraph.related</i>: more article titles that have related contents</li>
      <li><i>paragraph.tables</i>: a list of <i>WikipediaTable</i> objects found in this
      paragraph<br/></li>
    </ul>

    <p> </p>
    <hr/>

    <p><span class="grey_box">Article images</span></p>
    <p>Image objects in the <i>article.images</i> list have properties (like a description) that
    can help in discerning what is being displayed in the image:</p>
<pre>article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"computer"</span>)
<span class="k">for</span> img <span class="ow">in</span> article<span class="o">.</span>images:
    <span class="k">print</span> img<span class="o">.</span>description
<span class="o">&gt;&gt;&gt;</span> The NASA Columbia Supercomputer<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> A computer <span class="ow">in</span> a wristwatch<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> The Jacquard loom was one of the first programmable devices<span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">...</span>
</pre>

    <p>An image object has the following properties:</p>
    <ul>
      <li><i>image.path</i>: the image’s filename</li>
      <li><i>image.description</i>: a description parsed from the source content</li>
      <li><i>image.links</i>: a list of related article titles</li>
      <li><i>image properties</i>: a list of properties parsed from the source (e.g. <i>left</i>,
      <i>thumb</i>, ...)<br/></li>
    </ul>

    <p><br/>
    Finally, here is a little web mash-up to draw article images in PlotDevice:</p>
<pre>
<span class="c"># 1) Get the image filename from the article.</span>
article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"computer"</span>)
img <span class="o">=</span> article<span class="o">.</span>images[<span class="mi">0</span>]
 
<span class="c"># 2) Get the HTML for the Wikipedia page displaying the full-size image</span>
img <span class="o">=</span> img<span class="o">.</span>path<span class="o">.</span>replace(<span class="s">" "</span>, <span class="s">"_"</span>)
html <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(<span class="s">"http://en.wikipedia.org/wiki/Image:"</span><span class="o">+</span>img)
 
<span class="c"># 3) Find the link in the HTML pointing to the image file.</span>
<span class="k">for</span> a <span class="ow">in</span> html<span class="o">.</span>find_all(<span class="s">"a"</span>):
    <span class="k">if</span> a<span class="o">.</span>has_key(<span class="s">"href"</span>) <span class="ow">and</span> a[<span class="s">"href"</span>]<span class="o">.</span>endswith(img):
        img <span class="o">=</span> a[<span class="s">"href"</span>]
        <span class="k">break</span>
 
<span class="c"># 4) Download the image link.</span>
<span class="c">#    Pass the downloaded data to the image() command.</span>
img <span class="o">=</span> web<span class="o">.</span>download(img)
<span class="nf">image</span>(<span class="bp">None</span>, <span class="mi">0</span>, <span class="mi">0</span>, data<span class="o">=</span>img)
</pre>                                                                                                  

    <p><img alt="web-wikipedia1" height="326" src="../etc/lib/web-wikipedia1.jpg" width="550"/><br/></p>
    <p> </p>
    <hr/>

    <p><span class="grey_box">Article tables</span><br/></p>
    <p>Tables parsed from an article can be accessed from the <i>article.tables</i> list or from
    <i>article.paragraph[i].tables</i>. A table object is a list of rows. Each row is a list of
    cells:</p>
<pre>article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"computer"</span>)
table <span class="o">=</span> article<span class="o">.</span>tables[<span class="mi">0</span>]
<span class="k">print</span> table<span class="o">.</span>paragraph<span class="o">.</span>title
<span class="k">print</span> table<span class="o">.</span>title, <span class="s">"("</span><span class="o">+</span>table<span class="o">.</span>properties<span class="o">+</span><span class="s">")"</span>
<span class="k">for</span> row <span class="ow">in</span> table:
    <span class="k">print</span> <span class="s">"-"</span><span class="o">*</span><span class="mi">50</span>
    <span class="k">print</span> row<span class="o">.</span>properties
    <span class="k">for</span> cell <span class="ow">in</span> row:
        <span class="k">print</span> cell, <span class="s">"("</span><span class="o">+</span>cell<span class="o">.</span>properties<span class="o">+</span><span class="s">")"</span>
</pre>

    <p>As you can see, tables, rows and cells all have <i>properties.</i> Tables also have a
    <i>title</i> property and a <i>paragraph</i> property linking to the paragraph object in which
    this table was found.</p>
    <p> </p>
    <hr/>

    <p><span class="grey_box">Article references</span><br/></p>
    <p>Text blocks in a Wikipedia paragraph can contain numerous references to websites, journal
    and footnotes. They are marked as a number between square brackets, e.g. [15].</p>
    <p>For example:</p>
<pre>
<span class="o">&gt;&gt;&gt;</span> A key component common to <span class="nb">all</span> CPUs <span class="ow">is</span> the program counter, 
<span class="o">&gt;&gt;&gt;</span> a special memory cell (a register) that keeps track of which 
<span class="o">&gt;&gt;&gt;</span> location <span class="ow">in</span> memory the <span class="nb">next</span> instruction <span class="ow">is</span> to be read from<span class="o">.</span> [<span class="mi">11</span>]
</pre>

    <p>corresponds to <i>article.references[10]</i> - keeping in mind that list indices start from
    0:</p>
<pre>
<span class="k">print</span> article<span class="o">.</span>references[<span class="mi">10</span>]
<span class="o">&gt;&gt;&gt;</span> Instructions often occupy more than one memory address, 
<span class="o">&gt;&gt;&gt;</span> so the program counters usually increases by the number of 
<span class="o">&gt;&gt;&gt;</span> memory locations required to store one instruction
</pre>

    <p>Each reference object in the <i>article.references</i> list has a number of properties. In
    the worst case all of the information is stored in <i>reference.note</i>, in the best case the
    reference has data for all of the folllowing properties:</p>
    <ul>
      <li><i>reference.title</i>: a title of a publication<br/></li>
      <li><i>reference.url</i>: a link to a web page<br/></li>
      <li><i>reference.author</i>: the author of a publication<br/></li>
      <li><i>reference.first</i>: the author’s first name<br/></li>
      <li><i>reference.last</i>: the author’s last name</li>
      <li><i>reference.journal</i>: the journal in which the article is published</li>
      <li><i>reference.publisher</i>: the journal’s publisher</li>
      <li><i>reference.date</i>: publication date<br/></li>
      <li><i>reference.year</i>: publication year<br/></li>
      <li><i>reference.id</i>: an ISBN book number</li>
      <li><i>reference.note</i>: footnotes and descriptions</li>
    </ul>

    <p> </p>
    <hr/>

    <p><span class="grey_box">Article translations</span></p>
    <p>Here’s an example script how to get the translated version of an article:</p>
<pre>article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(<span class="s">"computer"</span>)
language <span class="o">=</span> <span class="s">"fr"</span>
<span class="k">if</span> article<span class="o">.</span>translations<span class="o">.</span>has_key(language):
    translation <span class="o">=</span> article<span class="o">.</span>translations[language]
    article <span class="o">=</span> web<span class="o">.</span>wikipedia<span class="o">.</span>search(translation, language)
    <span class="k">print</span> article<span class="o">.</span>title 
<span class="o">&gt;&gt;&gt;</span> Ordinateur
</pre>

    <p>The dictionary of all languages used in Wikipedia:</p>
<pre>
<span class="k">print</span> web<span class="o">.</span>wikipedia<span class="o">.</span>languages
</pre>                                                                                            
    <hr/>

    <h2><a id="wikipediahelpers" name="wikipediahelpers" title="wikipediahelpers"></a>Some helper
    commands to draw Wikipedia content in PlotDevice</h2>

    <p>A number of commands in the library can help you find out how to display content from
    Wikipedia in PlotDevice. There are commands to draw lists, math equations and tables.</p>
<pre>
<span class="c"># Returns True if a given text block str in a paragraph </span>
<span class="c"># is preformatted text, e.g. a programming code example.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>is_preformatted(<span class="nb">str</span>)
</pre>
<pre>
<span class="c"># Returns True if a text block in a paragraph is a (numbered) list.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>is_list(<span class="nb">str</span>)
</pre>
<pre>
<span class="c"># Returns True if a text block in a paragraph is a math equation.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>is_math(<span class="nb">str</span>)
</pre>
<pre>
<span class="c"># Draws a list text block at x, y coordinates in PlotDevice.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>draw_list(<span class="nb">str</span>, x, y, w, padding<span class="o">=</span><span class="mi">5</span>, callback<span class="o">=</span><span class="bp">None</span>)
</pre>
<pre>
<span class="c"># Use mimeTeX to draw an image of a math equation at x, y.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>draw_math(<span class="nb">str</span>, x, y, alpha<span class="o">=</span><span class="mf">1.0</span>)
</pre>
<pre>
<span class="c"># Draws WikipediaTable object in PlotDevice; works very poorly.</span>
web<span class="o">.</span>wikipedia<span class="o">.</span>draw_table(table, x, y, w, padding<span class="o">=</span><span class="mi">5</span>)
</pre>                                                                                    

    <p><img alt="web_wikipedia2" height="324" src="../etc/lib/web_wikipedia2.jpg" width="550"/></p>
    <p>    </p>
    <hr/>

    <h2><a id="morguefile" name="morguefile" title="morguefile"></a>Querying morgueFile for
    images</h2>

    <p><a href="http://www.morguefile.com">morgueFile</a> contains photographs freely contributed
    by many artists to be used in creative projects by visitors to the site.</p>
    <p>The <i>morguefile.search()</i> command returns a list of images on morgueFile that
    correspond to a given query. It has an optional parameter <i>max</i> specifying the maximum
    number of images to return:</p>
<pre>web<span class="o">.</span>morguefile<span class="o">.</span>search(q, <span class="nb">max</span><span class="o">=</span><span class="mi">100</span>, wait<span class="o">-</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>morguefile<span class="o">.</span>search_by_author(q, <span class="nb">max</span><span class="o">=</span><span class="mi">100</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>Each image object in the returned list has the following properties:</p>
    <ul>
      <li><i>img.id</i>: the unique morgueFile ID for the image</li>
      <li><i>img.category</i>: the category the image belongs to</li>
      <li><i>img.author</i>: the name of the author</li>
      <li><i>img.name</i>: the image’s name</li>
      <li><i>img.url</i>: the URL of the image thumbnail<br/>
      <i>img.width</i>: the image width in pixels</li>
      <li><i>img.height</i>: the image height in pixels</li>
      <li><i>img.date</i>: the date the image was added to morgueFile</li>
    </ul><br/>
<pre>images <span class="o">=</span> web<span class="o">.</span>morguefile<span class="o">.</span>search(<span class="s">"leaf"</span>, <span class="nb">max</span><span class="o">=</span><span class="mi">10</span>)
<span class="k">for</span> img <span class="ow">in</span> images:
    <span class="k">print</span> img<span class="o">.</span>name, img<span class="o">.</span>views
<span class="o">&gt;&gt;&gt;</span> IMG_1662_d<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> fedegrafo_100_0221<span class="o">.</span>jpg 
<span class="o">&gt;&gt;&gt;</span> cha827<span class="o">.</span>jpg 
<span class="o">&gt;&gt;&gt;</span> Filiford_P1010003<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> IMG_8336<span class="o">.</span>jpg 
<span class="o">&gt;&gt;&gt;</span> CIMG0012_s<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> Target_spot_disease_on_maple<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> IMG_1664<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> bumpy_leaf<span class="o">.</span>JPG 
<span class="o">&gt;&gt;&gt;</span> Aztec_Grass<span class="o">.</span>JPG
</pre>

    <p>Each image object in the list has a <i>download()</i> method that stores the image file
    locally in cache. It has an optional parameter <i>size</i>, which can be set to ‘small’ (image
    thumbnail) or ‘large’ (default):</p>
<pre>img <span class="o">=</span> images[<span class="mi">0</span>]
img<span class="o">.</span>download(<span class="nf">size</span><span class="o">=</span><span class="s">"large"</span>, wait<span class="o">=</span><span class="mi">60</span>)
<span class="nf">image</span>(img<span class="o">.</span>path, <span class="mi">0</span>, <span class="mi">0</span>, width<span class="o">=</span>img<span class="o">.</span>width, height<span class="o">=</span>img<span class="o">.</span>height)
<span class="k">print</span> img<span class="o">.</span>author, img<span class="o">.</span>path
<span class="o">&gt;&gt;&gt;</span> Filiford cache<span class="o">/</span>morguefile<span class="o">/</span><span class="mi">240060</span>eb1e1a0628ae32aff811b167ef<span class="o">.</span>JPG
</pre>                                                                                

    <p><img alt="web_morguefile2" height="366" src="../etc/lib/web_morguefile2.jpg" width="550"/></p>
    <p> </p>
    <hr size="2" width="100%"/>

    <h2><a id="flickr" name="flickr" title="flickr"></a>Querying Flickr for images</h2>

    <p><a href="http://www.flickr.com">Flickr</a> is an online photo management and sharing
    application.<br/>
    You can query it for images in the same way as <a href="#morguefile">querying morgueFile</a>.</p>
<pre>web<span class="o">.</span>flickr<span class="o">.</span>search(q, start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">100</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>flickr<span class="o">.</span>recent(start<span class="o">=</span><span class="mi">1</span>, count<span class="o">=</span><span class="mi">100</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>The <i>flickr.search()</i> command has two optional parameters: <i>sort</i> and
    <i>match</i>. The sort order can be set either to ‘interest’, ‘relevance’ (default) or ‘date’.
    The <i>match</i> parameter can be either ‘all’ (image tags must include all of the search
    words) or ‘any’ (default).</p>
    <p>Each image object in the returned list has a <i>download()</i> method like the morgueFile
    interface. The <i>download()</i> method has an optional <i>size</i> parameter which can be
    ‘square’, ‘small’, ‘medium’, ‘large’ and ‘wallpaper’. This way you can specify the size of the
    image to download.<br/></p>
    <p> </p>
    <hr/>

    <h2><a id="kuler" name="kuler" title="kuler"></a>Querying kuler for color themes</h2>

    <p><a href="http://kuler.adobe.com/">kuler</a> is an Adobe web-application that allows users to
    construct and share color themes.</p>
    <p>The <i>kuler.search()</i> command returns a list of color themes on kuler that correspong to
    a given query. It has an optional <i>page</i> parameter defining the starting page (each page
    has 30 themes).</p>
<pre>web<span class="o">.</span>kuler<span class="o">.</span>search(q, page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>kuler<span class="o">.</span>search_by_id(<span class="nb">id</span>, page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>kuler<span class="o">.</span>search_by_popularity(page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>kuler<span class="o">.</span>search_by_rating(page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>Each theme object in the returned list has the following properties:</p>
    <ul>
      <li><i>theme.id</i>: the unique kuler id for the theme</li>
      <li><i>theme.author</i>: the name of the author<br/></li>
      <li><i>theme.label</i>: the title of the theme<br/></li>
      <li><i>theme.tags</i>: a list of keywords for a theme found with
      <i>kuler.search_by_id()</i> </li>
      <li><i>theme.darkest</i>: a tuple of (R, G, B) values for the darkest color in the theme<br/></li>
      <li><i>theme.lightest</i>: a tuple of (R, G, B) values the lightest color in the theme<br/></li>
    </ul>

    <p>You can loop through a theme object as a list. Each item in the theme is a tuple of (R, G,
    B) values, which you can supply to <a href="../ref/Line+Color.html#fill()">fill()</a> or
    <a href="../ref/Line+Color.html#stroke()">stroke()</a> in PlotDevice.</p>
<pre>themes <span class="o">=</span> web<span class="o">.</span>kuler<span class="o">.</span>search(<span class="s">"banana"</span>)
<span class="k">for</span> r, g, b <span class="ow">in</span> themes[<span class="mi">0</span>]:
    <span class="k">print</span> r, g, b
 
<span class="c"># The kuler.preview() command gives you an idea of the theme's colors. </span>
web<span class="o">.</span>kuler<span class="o">.</span>preview(themes[<span class="mi">0</span>])
</pre>                                                                               

    <p><img alt="web_kuler1" height="394" src="../etc/lib/web_kuler1.jpg" width="550"/><br/></p>
    <p> </p>
    <p>Each theme also has a draw() method that displays the colors in the theme in PlotDevice:</p>
<pre>themes <span class="o">=</span> web<span class="o">.</span>kuler<span class="o">.</span>search(<span class="s">"banana"</span>)
themes[<span class="mi">0</span>]<span class="o">.</span>draw(<span class="mi">50</span>, <span class="mi">50</span>, w<span class="o">=</span><span class="mi">40</span>, h<span class="o">=</span><span class="mi">120</span>)
</pre>                                                                    

    <p><img alt="web_kuler2" height="299" src="../etc/lib/web_kuler2.jpg" width="549"/><br/></p>
    <p> </p>
    <hr size="2" width="100%"/>

    <h2><a id="colr" name="colr" title="colr"></a>Querying Colr for color themes</h2>

    <p><a href="http://www.colr.org">Colr</a> is an online tool by Lloyd Dalton to let people
    fiddle around with colors.<br/>
    You can query it for color themes in the same way as querying <a href="#kuler">kuler</a>.</p>
<pre>web<span class="o">.</span>colr<span class="o">.</span>search(q, page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>colr<span class="o">.</span>search_by_id(<span class="nb">id</span>, page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>colr<span class="o">.</span>latest(page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>
<pre>web<span class="o">.</span>colr<span class="o">.</span><span class="nf">random</span>(page<span class="o">=</span><span class="mi">0</span>, wait<span class="o">=</span><span class="mi">10</span>, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>You can manipulate each theme object in the returned list as with the kuler interface.<br/></p>
    <p> </p>
    <hr/>

    <h2><a id="math" name="math" title="math"></a> Creating PNG or GIF images from math
    equations</h2>

    <p>John Forkosh has a <a href="http://www.forkosh.com/mathtex.html">mathTeX server</a> that
    creates PNG or GIF images from math equations.</p>
<pre>web<span class="o">.</span>mathtext<span class="o">.</span>png(equation, dpi<span class="o">=</span><span class="mi">120</span>, <span class="nf">color</span><span class="o">=</span><span class="s">""</span>)
</pre>
<pre>web<span class="o">.</span>mathtext<span class="o">.</span>gif(equation, dpi<span class="o">=</span><span class="mi">120</span>, <span class="nf">color</span><span class="o">=</span><span class="s">""</span>)
</pre>

    <p>The optional <i>dpi</i> parameter sets the image resolution, while <i>color</i> can be the
    name of a primary color (e.g. blue, green, red, ...)</p>
<pre>equation <span class="o">=</span> <span class="s">r"E = hf = \frac{hc}{\lambda} \,\! "</span>
img <span class="o">=</span> web<span class="o">.</span>mathtex<span class="o">.</span>gif(equation)
<span class="nf">image</span>(img, <span class="mi">0</span>, <span class="mi">0</span>)
</pre>                                                                          

    <p><img alt="web_mimetex1" height="35" src="../etc/lib/web_mimetex1.jpg" width="153"/></p>
    <p> </p>
    <hr/>

    <h2><a id="urbandictionary" name="urbandictionary" title="urbandictionary"></a>Word definitions
    from Urban Dictionary</h2>

    <p><a href="http://www.urbandictionary.com">Urban Dictionary</a> is a slang dictionary with
    user-defined description for words. You can often get some humorous (or cruel and childish)
    results from it.</p>
    <p>The <i>urbandictionary.search()</i> command returns a list of definitions for a given word.</p>
<pre>web<span class="o">.</span>urbandictionary<span class="o">.</span>search(q, cached<span class="o">=</span><span class="bp">True</span>)
</pre>

    <p>Each definition object in the returned list has the following properties:</p>
    <ul>
      <li><i>definition.description</i>: a description of the given word</li>
      <li><i>definition.example</i>: example usage of the word in a sentence</li>
      <li><i>definition.author</i>: the author who came up with the definition</li>
      <li><i>definition.links</i>: a list of words linked to the definition</li>
      <li><i>definition.url</i>: the web page where the definition can be found</li>
    </ul>
<pre>definitions <span class="o">=</span> web<span class="o">.</span>urbandictionary<span class="o">.</span>search(<span class="s">"life"</span>)
<span class="k">print</span> definitions[<span class="mi">0</span>]<span class="o">.</span>description
<span class="o">&gt;&gt;&gt;</span> A sexually<span class="o">-</span>transmitted, terminal disease<span class="o">.</span>
</pre>                                              
    <hr/>

    <h2><a id="asynchronous" name="asynchronous" title="asynchronous"></a>Working with asynchronous
    downloads</h2>

    <p>Downloading content from the internet may take a moment to complete. When running an
    animation in PlotDevice, you don’t want it to halt while PlotDevice waits for the download to
    complete. The Web library offers you the capability to download <i>asynchronously</i>.
    N<b>odeBox will then continue running with the download taking place in the background
    memory</b>. Once it is done you can start manipulating the retrieved data.</p>
    <p>The <i>url.retrieve()</i> command has some optional parameters to do asynchronous downloads:</p>
<pre>web<span class="o">.</span>url<span class="o">.</span>retrieve(url, wait<span class="o">=</span><span class="mi">60</span>, asynchronous<span class="o">=</span><span class="bp">False</span>, cache<span class="o">=</span><span class="bp">None</span>, <span class="nb">type</span><span class="o">=</span><span class="s">".html"</span>)
</pre>

    <p>With <i>asynchronous</i> set to True, the download will occur in the background. The
    returned object has a <i>done</i> property which is True when downloading has terminated. The
    object’s <i>data</i> property then contains the source data.</p>
    <p>You can also set a <i>wait</i> amount of seconds that is the maximum amount of time
    PlotDevice will connect to the internet. When the limit is exceeded and no data was fully
    recovered, the returned object will have an <i>error</i> property set. When something else went
    wrong <i>error</i> will be set as well by the way, usually with a <i>URLTimeout</i>, a
    <i>HTTPError</i> or a <i>HTTP404NotFound</i> exception. </p>
<pre>data <span class="o">=</span> web<span class="o">.</span>url<span class="o">.</span>retrieve(<span class="s">"http://nodebox.net"</span>, asynchronous<span class="o">=</span><span class="bp">True</span>)
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">while</span> <span class="ow">not</span> data<span class="o">.</span>done:
    time<span class="o">.</span>sleep(<span class="mf">0.1</span>)
    <span class="k">print</span> <span class="s">"downloading..."</span>
<span class="k">print</span> <span class="s">"done!"</span>
<span class="o">&gt;&gt;&gt;</span> downloading<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> downloading<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> downloading<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> downloading<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> done<span class="err">!</span>
</pre>

    <p>Since all of the services in the Web library build upon <i>url.retrieve()</i>, you can also
    use the <i>asynchronous</i> parameter with <i>page.parse()</i>, <i>yahoo.search()</i>,
    <i>newsfeed.parse()</i>, <i>wikipedia.search()</i>, <i>morguefile.search()</i>,
    <i>morguefile_image.download()</i> and <i>kuler.search()</i>.</p>
    <p>An exception is the Urban Dictionary which uses SOAP instead of <i>url.retrieve()</i>.</p>
    <p>Here’s a quick mash-up of an interactive link browser. It starts out with some links from
    Yahoo! and when you click on a link, it displays the links in that web page, and so on.</p>
<pre>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> sin
<span class="kn">import</span> <span class="nn">web</span>
 
<span class="c"># Get links from Yahoo!</span>
links <span class="o">=</span> web<span class="o">.</span>yahoo<span class="o">.</span>search(<span class="s">"plotdevice"</span>)
from_yahoo <span class="o">=</span> <span class="bp">True</span>
retrieving <span class="o">=</span> <span class="bp">None</span>
 
<span class="nf">speed</span>(<span class="mi">20</span>)
<span class="k">def</span> <span class="nf">draw</span>():
    
    <span class="k">global</span> links, from_yahoo, retrieving
    
    <span class="nf">background</span>(<span class="mf">0.2</span>, <span class="mf">0.2</span>, <span class="mf">0.15</span>)
    y <span class="o">=</span> <span class="mi">100</span>
    <span class="nf">fontsize</span>(<span class="mi">15</span>)
    
    <span class="c"># Traverse the current list of links.</span>
    <span class="k">for</span> link <span class="ow">in</span> links:
        
        <span class="c"># Wave each line of text horizontally.</span>
        x <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> sin(<span class="kc">FRAME</span><span class="o">*</span>y<span class="o">/</span><span class="mf">5000.0</span>)<span class="o">*</span><span class="mi">50</span>
        
        <span class="c"># Yahoo!, our starting point,</span>
        <span class="c"># has links in a slightly different format.</span>
        <span class="k">if</span> from_yahoo:
            link <span class="o">=</span> link<span class="o">.</span>url
        
        <span class="c"># A link looks grey by default...</span>
        <span class="nf">fill</span>(<span class="mf">0.8</span>)
        
        <span class="c"># unless the mouse is hovering over it...</span>
        <span class="k">if</span> x <span class="o">&lt;</span> MOUSEX <span class="o">&lt;</span> x<span class="o">+</span><span class="nf">textwidth</span>(link) <span class="ow">and</span> \
           y<span class="o">-</span><span class="nf">fontsize</span>() <span class="o">&lt;</span> MOUSEY <span class="o">&lt;</span> y:
            <span class="c"># in which case it is pink.</span>
            <span class="nf">fill</span>(<span class="mi">1</span>, <span class="mi">0</span>, <span class="mf">0.5</span>)
            <span class="c"># When the mouse is pressed on a link</span>
            <span class="c"># and we are not downloading anything,</span>
            <span class="c"># start a download of the link in the background.</span>
            <span class="k">if</span> mousedown <span class="ow">and</span> retrieving <span class="o">==</span> <span class="bp">None</span>:
                retrieving <span class="o">=</span> web<span class="o">.</span>page<span class="o">.</span>parse(link, asynchronous<span class="o">=</span><span class="bp">True</span>)
        
        <span class="c"># Draw the link to the screen.</span>
        <span class="nf">text</span>(link, x, y)
        y <span class="o">+=</span> <span class="nf">fontsize</span>() <span class="o">*</span> <span class="mf">1.5</span>
 
    <span class="c"># If we are downloading something</span>
    <span class="c"># and the download is ready,</span>
    <span class="c"># parse that web page and get links from it.</span>
    <span class="c"># Update the current list of links with the links on this page.</span>
    <span class="k">if</span> retrieving <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> retrieving<span class="o">.</span>done:
        links <span class="o">=</span> retrieving<span class="o">.</span>links()
        from_yahoo <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># We are done downloading.</span>
        retrieving <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c"># We are busy downloading.</span>
    <span class="k">if</span> retrieving <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> retrieving<span class="o">.</span>done:
        <span class="nf">fill</span>(<span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">0</span>)
        <span class="nf">text</span>(<span class="s">"please wait...."</span>, <span class="mi">10</span>, <span class="mi">20</span>)
</pre>                                                  

    <p><img alt="web_asynchronous1" height="387" src="../etc/lib/web_asynchronous1.jpg" width="550"/><br/></p>
    <p> </p>
    <hr/>

    <h2><a id="cache" name="cache" title="cache"></a>Clearing the cache</h2>

    <p>Most of the content you retrieve with the Web library is cached for faster retrieval in the
    future. At some point you may want to empty the cache (it can grow quite large). This is easy -
    to erase the cache completely just do:<br/></p>
<pre>web<span class="o">.</span>clear_cache()
</pre>

    <p>To clear individual caches:</p>
<pre>web<span class="o">.</span>yahoo<span class="o">.</span>clear_cache()
web<span class="o">.</span>wikipedia<span class="o">.</span>clear_cache()
web<span class="o">.</span>morguefile<span class="o">.</span>clear_cache() 
<span class="c"># etc... clear_cache() is available for each service in the library</span>
</pre>                
    <hr size="2" width="100%"/>

    <h2><a id="json" name="json" title="json"></a>Reading JSON</h2>

    <p><a href="http://json.org/">JSON</a> (JavaScript Object Notation) is a lightweight
    data-interchange format. If you have some JSON data you need to parse into a Python dictionary
    you can use the bundled and super-easy library by Patrick D. Logan:</p>
<pre>colr_data <span class="o">=</span> web<span class="o">.</span>json<span class="o">.</span>read(colr_data)
<span class="k">for</span> theme <span class="ow">in</span> colr_data[<span class="s">"schemes"</span>]:
    theme_id <span class="o">=</span> theme[<span class="s">"id"</span>]
</pre>                

    <p>
                    </p>
    <hr/>

    <p>The PlotDevice Web library addresses the following API’s:</p>
    <ul>
      <li>Yahoo!: <a href="http://developer.yahoo.com/search/">http://developer.yahoo.com/search/</a></li>
      <li>Wikipedia: <a href="http://www.mediawiki.org/wiki/API">http://www.mediawiki.org/wiki/API</a><br/></li>
      <li>morgueFile: <a href="http://www.morguefile.com/wiki/index.php/Morguefile_api_">http://www.morguefile.com/wiki/index.php/Morguefile_api</a></li>
      <li>Flickr: <a href="http://www.flickr.com/services/api/">http://www.flickr.com/services/api/</a><br/></li>
      <li>kuler: <a href="http://deliciouslymeta.com/kuler/k_docs.php">http://deliciouslymeta.com/kuler/k_docs.php</a></li>
      <li>Colr: <a href="http://www.colr.org/api.html">http://www.colr.org/api.html</a><br/></li>
      <li>mimeTeX: <a href="http://www.forkosh.com/mimetex.html">http://www.forkosh.com/mimetex.html</a></li>
      <li>Urban Dictionary: <a href="http://www.urbandictionary.com/api.php">http://www.urbandictionary.com/api.php</a></li>
    </ul>

    <p> </p>
  </div>

</body></html>