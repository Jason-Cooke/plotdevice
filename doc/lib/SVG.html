<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>

  <title>PlotDevice Libraries: SVG</title>
  <link charset="utf-8" href="../etc/manual.css" rel="stylesheet" type="text/css"/>

</head><body>
  <div class="link" id="nav">
    <h1><a href="../manual.html">Plot Device <span>Libraries</span></a></h1>

    <h3>SVG</h3>
  </div>

  <div class="article">
    <h2>Description</h2>

    <p>The SVG library gives control over vector work imported into PlotDevice. Rectangles, circles
    and paths from an SVG file are imported as native PlotDevice paths, so their individual points
    and colors can be manipulated (see the tutorial on <a href="../tut/Paths.html">Paths</a>).</p>
    <p>’SVG’ means Scalable Vector Graphics and is an XML format. You can save SVG files from
    <a href="http://www.inkscape.org/">Inkscape</a> and Illustrator. Hand-draw your shapes there
    and then manipulate them further in PlotDevice.</p>
    <p>The SVG library has been tested for the following Illustrator functionalities: rectangles,
    ellipses, polygons, lines, curves constructed with the pen-tool, fill colors, stroke colors,
    stroke widths and transparency. Complicated things like gradient fills are ignored.</p>
    <h2>Download</h2>

    <table border="0">
      <tbody>
        <tr>
          <td><a href="http://nodebox.net/code/data/media/svg.zip"><img alt="download" height="20" src="../etc/lib/download.gif" width="20"/></a>
          </td><td><a href="http://nodebox.net/code/data/media/svg.zip">svg.zip</a> (400KB)<br/>
          <i>Last updated for PlotDevice 1.9.4.5<br/></i><i>Licensed under GPL</i><br/>
          <i>Author: Tom De Smedt</i><br/>
        </td></tr></tbody></table>

    <h2>Documentation</h2>

    <ul>
      <li><a href="#library">How to get the library up and running</a></li>
      <li><a href="#export">Preparing SVG files</a></li>
      <li><a href="#parse">Importing SVG files</a></li>
      <li><a href="#furry">A simple path filter</a></li>
      <li><a href="#group_transform">Transforming a group of paths</a><br/></li>
    </ul>

    <p> </p>
    <hr/>

    <h2><a id="library" name="library" title="library"></a>How to get the library up and
    running</h2>

    <p>Put the <i>svg</i> library folder in the same folder as your script so PlotDevice can find
    the library. You can also put it in ~/Library/Application Support/PlotDevice/.</p>
<pre>svg <span class="o">=</span> <span class="nf">ximport</span>(<span class="s">"svg"</span>)
</pre>         
    <hr/>

    <h2><a id="export" name="export" title="export"></a>Preparing SVG files</h2>

    <p>To export files as SVG from Adobe Illustrator do the following:</p>
    <ul>
      <li>Choose File &gt; Save As...</li>
      <li>In the file dialog, select ‘SVG (svg)’ (not ‘SVG Compressed’ - we can’t read compressed
      files)</li>
      <li>In the next window, choose ‘SVG Tiny 1.2’ as the SVG Profile.<br/>
      The regular SVG format saves all swatches and patterns, which is useless outside of
      Illustrator. Leave the rest of the settings as-is.</li>
    </ul>

    <p><span class="media"><img height="414" src="../etc/lib/svg-export.jpg" width="500"/></span></p>
    <hr/>

    <h2><a id="parse" name="parse" title="parse"></a>Importing SVG files</h2>
<pre>parse(<span class="nb">str</span>, cached<span class="o">=</span><span class="bp">False</span>)
</pre>

    <p>The <i>parse()</i> command reads SVG source and returns a list of <a href="../tut/Paths.html">paths</a> that are drawable with <a href="../ref/Drawing.html#drawpath()">drawpath()</a>. The command has an optional <i>cached</i>
    parameter. When set to <i>True</i>, the SVG source is analyzed only once and the parsed paths
    stored in memory so they load faster.</p>
    <p>Each returned path in the list has the following properties:</p>
    <ul>
      <li><i>path</i>.closed: is set to True when the path is closed</li>
      <li><i>path</i>.fill: the fill color of the path in the SVG file</li>
      <li><i>path</i>.stroke: the stroke color of the path in the SVG file</li>
      <li><i>path</i>.strokewidth: the stroke width of the path in the SVG file.<br/></li>
    </ul>

    <p>These can be used to copy color information from the original vector drawing. Read the
    <a href="../tut/Paths.html">tutorial on paths</a> to see what you can do with the points of a
    path.</p>
    <p>For example, here’s one of Ludivine Lechat’s Illustrator drawings. We can import the paths
    into PlotDevice. Those that have a fill color will retain their original fill.</p>
    <p> </p>
    <p><span class="media"><img height="668" src="../etc/lib/svg-illustrator.jpg" width="634"/></span></p>
<pre>data <span class="o">=</span> <span class="nb">open</span>(<span class="s">"flower.svg"</span>)<span class="o">.</span>read()
paths <span class="o">=</span> svg<span class="o">.</span>parse(data)
 
<span class="k">for</span> path <span class="ow">in</span> paths:
  <span class="k">try</span>:
    <span class="nf">fill</span>(path<span class="o">.</span><span class="nf">fill</span>)
  <span class="k">except</span>:
    <span class="nf">fill</span>(<span class="nf">random</span>(), <span class="mi">0</span>, <span class="mi">0</span>)
  <span class="nf">drawpath</span>(path)
</pre>

    <p><span class="media">In the following example we override the colors in the original
    document. We only fill paths that are closed, in shades of the same color:</span></p>
    <p> </p>
    <p><span class="media"><img height="647" src="../etc/lib/svg-plotdevice.jpg" width="739"/></span></p>
    <p> </p>
    <hr/>

    <h2><a id="furry" name="furry" title="furry"></a>A simple path filter</h2>

    <p>Since all of the imported artwork are standard PlotDevice paths, I can also manipulate them
    with <a href="../tut/Paths.html#Path_Mathematics">path mathematics</a>, transform them like the
    <a href="../tut/LetterKnitter.html">LetterKnitter</a>. After some fumbling with paths and a
    nice gradient background, here is a hairy version of our flower. The bottom paths are darker to
    create a sense of depth.</p>
    <p> </p>
    <p><span class="media"><img height="647" src="../etc/lib/svg-pathfilter.jpg" width="739"/></span></p>
    <p>Below is some example code used to alter the path.<br/>
    You can see it in use in the <a href="http://nodebox.net/code/index.php/Superfolia">Superfolia</a> project in the gallery.</p>
<pre>
<span class="k">def</span> <span class="nf">draw_furry</span>(path):
    prev <span class="o">=</span> <span class="bp">None</span>
    <span class="nf">autoclosepath</span>(<span class="bp">False</span>)
    <span class="nf">nofill</span>()
    <span class="k">for</span> pt <span class="ow">in</span> path<span class="o">.</span>points(<span class="mi">100</span>):
        <span class="nf">stroke</span>(<span class="mi">1</span>, <span class="mf">0.5</span>)
        <span class="nf">strokewidth</span>(<span class="nf">random</span>(<span class="mf">0.5</span>))
        <span class="k">if</span> prev <span class="o">!=</span> <span class="bp">None</span>:
            <span class="nf">beginpath</span>(prev<span class="o">.</span>x, prev<span class="o">.</span>y)
            <span class="nf">curveto</span>(
                pt<span class="o">.</span>ctrl1<span class="o">.</span>x <span class="o">-</span> <span class="nf">random</span>(<span class="mi">30</span>), 
                pt<span class="o">.</span>ctrl1<span class="o">.</span>y,
                pt<span class="o">.</span>ctrl2<span class="o">.</span>x, 
                pt<span class="o">.</span>ctrl2<span class="o">.</span>y <span class="o">+</span> <span class="nf">random</span>(<span class="mi">30</span>),
                pt<span class="o">.</span>x, 
                pt<span class="o">.</span>y
            )
            <span class="nf">curveto</span>(
                pt<span class="o">.</span>ctrl1<span class="o">.</span>x <span class="o">+</span> <span class="nf">random</span>(<span class="mi">10</span>), 
                pt<span class="o">.</span>ctrl1<span class="o">.</span>y,
                pt<span class="o">.</span>ctrl2<span class="o">.</span>x, 
                pt<span class="o">.</span>ctrl2<span class="o">.</span>y <span class="o">-</span> <span class="nf">random</span>(<span class="mi">10</span>),
                pt<span class="o">.</span>x <span class="o">+</span> <span class="nf">random</span>(<span class="o">-</span><span class="mi">20</span>, <span class="mi">20</span>), 
                pt<span class="o">.</span>y <span class="o">+</span> <span class="nf">random</span>(<span class="o">-</span><span class="mi">20</span>, <span class="mi">20</span>)
            )
            <span class="nf">endpath</span>()
        prev <span class="o">=</span> pt
</pre>

    <p>More path filters can be found <a href="../tut/Path_Filters.html">here</a>.</p>
    <p> </p>
    <hr size="2" width="100%"/>

    <h2><a id="group_transform" name="group_transform" title="group_transform"></a>Transforming a
    group of paths</h2>

    <p>When you import an SVG file a list of paths is returned. All of these paths may make up a
    single drawing and you may encounter difficulties when <b>rotating and scaling the drawing a
    whole</b>. Below are two commands to help you along.</p>
    <p>The first command, <i>bounds()</i>, calculates the position and total size of a list of
    paths. The second command, <i>drawpaths()</i>, draws all of the paths rotating and scaling from
    the given origin. By default origin is (0.5, 0.5) which means the center of the group.</p>
<pre>
<span class="k">def</span> <span class="nf">bounds</span>(paths<span class="o">=</span>[]):
   <span class="sd">""" Returns (x, y), (width, height) bounds for a group of paths.</span>
<span class="sd">   """</span>
   <span class="k">if</span> <span class="nb">len</span>(paths) <span class="o">==</span> <span class="mi">0</span>: 
       <span class="k">return</span> (<span class="mi">0</span>,<span class="mi">0</span>), (<span class="mi">0</span>,<span class="mi">0</span>)
   l <span class="o">=</span> t <span class="o">=</span> <span class="nb">float</span>(<span class="s">"inf"</span>)
   r <span class="o">=</span> b <span class="o">=</span> <span class="nb">float</span>(<span class="s">"-inf"</span>)
   <span class="k">for</span> path <span class="ow">in</span> paths:
       (x, y), (w, h) <span class="o">=</span> path<span class="o">.</span>bounds
       l <span class="o">=</span> <span class="nb">min</span>(l, x)
       t <span class="o">=</span> <span class="nb">min</span>(t, y)
       r <span class="o">=</span> <span class="nb">max</span>(r, x<span class="o">+</span>w)
       b <span class="o">=</span> <span class="nb">max</span>(b, y<span class="o">+</span>h)
   <span class="k">return</span> (l, t), (r<span class="o">-</span>l, b<span class="o">-</span>t)
</pre>
<pre>
<span class="k">def</span> <span class="nf">drawpaths</span>(paths<span class="o">=</span>[], x<span class="o">=</span><span class="mi">0</span>, y<span class="o">=</span><span class="mi">0</span>, <span class="nf">rotate</span><span class="o">=</span><span class="mi">0</span>, <span class="nf">scale</span><span class="o">=</span><span class="mf">1.0</span>, origin<span class="o">=</span>(<span class="mf">0.5</span>,<span class="mf">0.5</span>)):
   <span class="sd">""" Draws a group of paths that rotate and scale from the given origin.</span>
<span class="sd">   """</span>
   _ctx<span class="o">.</span><span class="nf">transform</span>(<span class="kc">CORNER</span>)
   _ctx<span class="o">.</span><span class="nf">push</span>()
   _ctx<span class="o">.</span><span class="nf">translate</span>(x, y)
   _ctx<span class="o">.</span><span class="nf">rotate</span>(<span class="nf">rotate</span>)
   _ctx<span class="o">.</span><span class="nf">scale</span>(<span class="nf">scale</span>)
   (x, y), (w, h) <span class="o">=</span> bounds(paths)
   _ctx<span class="o">.</span><span class="nf">translate</span>((<span class="o">-</span>x<span class="o">-</span>w)<span class="o">*</span>origin[<span class="mi">0</span>], (<span class="o">-</span>y<span class="o">-</span>h)<span class="o">*</span>origin[<span class="mi">1</span>])
   <span class="k">for</span> path <span class="ow">in</span> paths:
       <span class="c">#_ctx.fill(path.fill)</span>
       <span class="c">#_ctx.stroke(path.stroke)</span>
       <span class="c">#_ctx.strokewidth(path.strokewidth)</span>
       <span class="c"># Use copies of the paths that adhere to the transformations.</span>
       _ctx<span class="o">.</span><span class="nf">drawpath</span>(path<span class="o">.</span>copy())
   _ctx<span class="o">.</span><span class="nf">pop</span>()
</pre>        
    <hr/>

    <p>Finally, remember that when you want to supply one path multiple times to drawpath(), each
    with its own translation and rotation, you need to <b>feed copies of the path to drawpath</b>:</p>
<pre>path <span class="o">=</span> svg<span class="o">.</span>parse(data)[<span class="mi">0</span>]
<span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span>(<span class="mi">5</span>):
  <span class="nf">rotate</span>(i<span class="o">*</span><span class="mi">10</span>)
  <span class="nf">drawpath</span>(path<span class="o">.</span>copy())
</pre>

    <p> </p>
  </div>

</body></html>